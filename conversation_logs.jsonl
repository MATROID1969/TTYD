{"timestamp": "2026-01-13T10:42:38.840035", "previous_question": null, "user_input": "Melyik a legnépszerűbb uticélpont? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb uticélpont? ", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:42:44.566597", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-13T10:42:56.931613", "previous_question": "Melyik a legnépszerűbb uticélpont? ", "user_input": "És a nők között?", "gate_decision": "FOLLOWUP", "rewritten_question": "Melyik a legnépszerűbb úti célpont a nők körében?", "sent_to_ai": "Melyik a legnépszerűbb úti célpont a nők körében?", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:43:02.921133", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Demográfiai szűrés: csak nők\ngender_col = \"Nem\"\ncountry_col = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\n\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\ndf_sub = df[df[gender_col] == \"Nő\"].copy()\n\nseries_lists = df_sub[country_col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-13T10:43:35.861184", "previous_question": "Melyik a legnépszerűbb úti célpont a nők körében?", "user_input": "Melyik a legnépszerűbb gyorsétterem? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb gyorsétterem? ", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:43:41.222837", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó márkánként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-13T10:43:52.248739", "previous_question": "Melyik a legnépszerűbb gyorsétterem? ", "user_input": "És a második?", "gate_decision": "FOLLOWUP", "rewritten_question": "Melyek a két legnépszerűbb gyorséttermek sorrendben?", "sent_to_ai": "Melyek a két legnépszerűbb gyorséttermek sorrendben?", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:43:57.542839", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\ntop2 = counts.head(2).index.tolist()\n\nresult = top2"}
{"timestamp": "2026-01-13T10:44:22.849986", "previous_question": "Melyek a két legnépszerűbb gyorséttermek sorrendben?", "user_input": "Válaszadók hány százaléka eszik csokit naponta? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Válaszadók hány százaléka eszik csokit naponta? ", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:44:25.753777", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\ncol = \"Milyen gyakran fogyaszt Ön táblás csokoládét, csokoládészeletet?\"\n\n# A \"naponta\" fogyasztók: \"(szinte) minden nap\"\ntarget = \"(szinte) minden nap\"\n\ntotal = df[col].notna().sum()\ncount = (df[col] == target).sum()\n\npercent = (count / total) * 100 if total > 0 else 0.0\n\nresult = float(round(percent, 1))"}
{"timestamp": "2026-01-13T10:45:08.825036", "previous_question": "Válaszadók hány százaléka eszik csokit naponta? ", "user_input": "Férfiak vagy a nők körében magasabb a csoki fogyasztók aránya? ", "gate_decision": "FOLLOWUP", "rewritten_question": "A férfiak vagy a nők körében magasabb azok aránya, akik naponta esznek csokoládét?", "sent_to_ai": "A férfiak vagy a nők körében magasabb azok aránya, akik naponta esznek csokoládét?", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:45:14.254084", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\ncol_gender = \"Nem\"\ncol_choco = \"Milyen gyakran fogyaszt Ön táblás csokoládét, csokoládészeletet?\"\ntarget_value = \"(szinte) minden nap\"\n\n# Férfiak\ndf_male = df[df[col_gender] == \"Férfi\"]\nn_male = len(df_male)\nn_male_daily = (df_male[col_choco] == target_value).sum()\npct_male = n_male_daily / n_male * 100 if n_male > 0 else 0\n\n# Nők\ndf_female = df[df[col_gender] == \"Nő\"]\nn_female = len(df_female)\nn_female_daily = (df_female[col_choco] == target_value).sum()\npct_female = n_female_daily / n_female * 100 if n_female > 0 else 0\n\nif pct_male > pct_female:\n    result = \"Férfiak\"\nelif pct_female > pct_male:\n    result = \"Nők\"\nelse:\n    result = \"Az arány megegyezik\""}
{"timestamp": "2026-01-13T10:46:20.248941", "previous_question": "A férfiak vagy a nők körében magasabb azok aránya, akik naponta esznek csokoládét?", "user_input": "Rajzolj egy sávdiagramot hogy a férfiak és nők milyen gyakran fogyasztanak csokit? ", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy sávdiagramot, amely bemutatja, hogy a férfiak és a nők milyen gyakran fogyasztanak csokoládét!", "sent_to_ai": "Rajzolj egy sávdiagramot, amely bemutatja, hogy a férfiak és a nők milyen gyakran fogyasztanak csokoládét!", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:46:28.204399", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\ncol = \"Milyen gyakran fogyaszt Ön táblás csokoládét, csokoládészeletet?\"\ndem_col = \"Nem\"\n\n# A válaszlehetőségek sorrendje a META alapján\norder = [\n    \"(szinte) minden nap\",\n    \"legalább hetente egyszer\",\n    \"legalább havonta egyszer\",\n    \"ritkábban mint havonta\",\n    \"sosem fogyasztom\"\n]\n\n# Eloszlás számítása nemenként\ndist_male = (\n    df[df[dem_col] == \"Férfi\"][col]\n    .dropna()\n    .value_counts(normalize=True)\n    .reindex(order, fill_value=0)\n    .mul(100)\n    .round(1)\n)\n\ndist_female = (\n    df[df[dem_col] == \"Nő\"][col]\n    .dropna()\n    .value_counts(normalize=True)\n    .reindex(order, fill_value=0)\n    .mul(100)\n    .round(1)\n)\n\n# Összefűzés egy DataFrame-be\ndist_df = pd.DataFrame({\n    \"Férfiak\": dist_male,\n    \"Nők\": dist_female\n})\n\nfig, ax = plt.subplots(figsize=(8,4))\ndist_df.plot(kind=\"bar\", ax=ax)\nax.set_ylabel(\"Százalék (%)\")\nax.set_xlabel(\"Fogyasztási gyakoriság\")\nax.set_title(\"Csokoládéfogyasztás gyakorisága nemenként\")\nax.legend(title=\"Nem\")\n\nresult = fig"}
{"timestamp": "2026-01-13T10:47:47.623112", "previous_question": "Rajzolj egy sávdiagramot, amely bemutatja, hogy a férfiak és a nők milyen gyakran fogyasztanak csokoládét!", "user_input": "Budapesti férfiak hogyan vásárolnak autót? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Budapesti férfiak hogyan vásárolnak autót? ", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:48:13.374817", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\n# Szűrés: budapesti férfiak\ngender_col = \"Nem\"\nlocation_col = \"Településtípus\"\npurchase_col = \"Hogyan vásárolták az Ön vagy családja által leggyakrabban használt autót?\"\n\ndf_sub = df[(df[gender_col] == \"Férfi\") & (df[location_col] == \"Budapest\")].copy()\n\ndist = (\n    df_sub[purchase_col]\n    .dropna()\n    .value_counts(normalize=True)\n    .mul(100)\n    .round(1)\n)\n\nfig, ax = plt.subplots(figsize=(8,3))\ndist.plot(kind=\"bar\", ax=ax)\nax.set_ylabel(\"Százalék (%)\")\nax.set_xlabel(\"\")\nax.set_title(\"Budapesti férfiak: autóvásárlás módja\")\n\nresult = fig"}
{"timestamp": "2026-01-13T10:48:37.950488", "previous_question": "Budapesti férfiak hogyan vásárolnak autót? ", "user_input": "És a budapesti nők?", "gate_decision": "FOLLOWUP", "rewritten_question": "Hogyan vásárolnak autót a budapesti férfiak és nők, és miben különböznek ezek a vásárlási szokások?", "sent_to_ai": "Hogyan vásárolnak autót a budapesti férfiak és nők, és miben különböznek ezek a vásárlási szokások?", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:48:49.886755", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\ncol = \"Hogyan vásárolták az Ön vagy családja által leggyakrabban használt autót?\"\ngender_col = \"Nem\"\nlocation_col = \"Településtípus\"\n\n# Csak budapestiek\ndf_bp = df[df[location_col] == \"Budapest\"].copy()\n\n# Férfiak eloszlása\ndist_male = (\n    df_bp[df_bp[gender_col] == \"Férfi\"][col]\n    .dropna()\n    .value_counts(normalize=True)\n    .mul(100)\n    .round(1)\n)\n\n# Nők eloszlása\ndist_female = (\n    df_bp[df_bp[gender_col] == \"Nő\"][col]\n    .dropna()\n    .value_counts(normalize=True)\n    .mul(100)\n    .round(1)\n)\n\n# Közös index (összes lehetséges válasz)\nall_idx = sorted(set(dist_male.index).union(dist_female.index))\n\ndist_male = dist_male.reindex(all_idx, fill_value=0)\ndist_female = dist_female.reindex(all_idx, fill_value=0)\n\n# Összehasonlító sávdiagram\nfig, ax = plt.subplots(figsize=(8,3))\nwidth = 0.35\nx = range(len(all_idx))\nax.bar([i - width/2 for i in x], dist_male.values, width=width, label=\"Férfiak\")\nax.bar([i + width/2 for i in x], dist_female.values, width=width, label=\"Nők\")\n\nax.set_xticks(list(x))\nax.set_xticklabels(all_idx, rotation=20, ha=\"right\")\nax.set_ylabel(\"Százalék (%)\")\nax.set_title(\"Autóvásárlás módja Budapesten nemek szerint\")\nax.legend()\n\nresult = fig"}
{"timestamp": "2026-01-13T10:49:57.658825", "previous_question": "Hogyan vásárolnak autót a budapesti férfiak és nők, és miben különböznek ezek a vásárlási szokások?", "user_input": "A különböző életkorú autóval rendelkezők hány százaléka tervez autót vásárolni? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "A különböző életkorú autóval rendelkezők hány százaléka tervez autót vásárolni? ", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:50:09.370453", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\n# Életkor az autóban: \"Hány éves a legfiatalabb autó az Önök háztartásában? Mindegy, hogy Ön vagy más vezeti az adott autót.\"\n# Autóvásárlási szándék: \"Tervez-e autót vásárolni a következő 1 évben?\"\n\nage_col = \"Hány éves a legfiatalabb autó az Önök háztartásában? Mindegy, hogy Ön vagy más vezeti az adott autót.\"\nbuy_col = \"Tervez-e autót vásárolni a következő 1 évben?\"\n\n# Az autóval nem rendelkezők kizárása\nno_car_value = \"Nincs autó a háztartásban\"\nage_values = [\n    \"1 évnél fiatalabb\", \"1-3 éves\", \"4-7 éves\", \"8-10 éves\",\n    \"11-13 éves\", \"14-17 éves\", \"18-20 éves\", \"20 évnél idősebb\"\n]\n\n# Autóvásárlást tervezők\nbuy_values = [\n    \"igen, biztos, hogy vásárolok autót\",\n    \"gondolkodom az autó vásároláson, de még nem biztos, hogy vásárolok\"\n]\n\n# Csak autóval rendelkezők\ndf_sub = df[df[age_col].isin(age_values)].copy()\n\n# Csoportosítás: autó életkora szerint, azon belül vásárlási szándék aránya\ndef calc_percent(group):\n    n = len(group)\n    if n == 0:\n        return 0.0\n    n_buy = group[buy_col].isin(buy_values).sum()\n    return round(n_buy / n * 100, 1)\n\npercent_by_age = (\n    df_sub\n    .groupby(age_col)\n    .apply(calc_percent)\n    .reindex(age_values)\n)\n\nresult = percent_by_age"}
{"timestamp": "2026-01-13T10:51:12.407380", "previous_question": "A különböző életkorú autóval rendelkezők hány százaléka tervez autót vásárolni? ", "user_input": "Készíts ez alapján diagramot!", "gate_decision": "FOLLOWUP", "rewritten_question": "Készíts egy diagramot arról, hogy a különböző életkorú autóval rendelkezők hány százaléka tervez autót vásárolni!", "sent_to_ai": "Készíts egy diagramot arról, hogy a különböző életkorú autóval rendelkezők hány százaléka tervez autót vásárolni!", "app": "Market research talk"}
{"timestamp": "2026-01-13T10:51:32.736114", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\n# Érintett mezők\nage_col = \"Hány éves a legfiatalabb autó az Önök háztartásában? Mindegy, hogy Ön vagy más vezeti az adott autót.\"\nplan_col = \"Tervez-e autót vásárolni a következő 1 évben?\"\n\n# Az autóval nem rendelkezők kizárása\nno_car_value = \"Nincs autó a háztartásban\"\nage_values = [\n    \"1 évnél fiatalabb\", \"1-3 éves\", \"4-7 éves\", \"8-10 éves\",\n    \"11-13 éves\", \"14-17 éves\", \"18-20 éves\", \"20 évnél idősebb\"\n]\n\n# Autóval rendelkezők szűrése\ndf_sub = df[~df[age_col].isin([no_car_value]) & df[age_col].notna()].copy()\n\n# Csak a releváns életkor-kategóriák sorrendben\ndf_sub = df_sub[df_sub[age_col].isin(age_values)]\n\n# Vásárlási szándék: csak akik biztosan vagy gondolkodnak rajta\nplan_values = [\n    \"igen, biztos, hogy vásárolok autót\",\n    \"gondolkodom az autó vásároláson, de még nem biztos, hogy vásárolok\"\n]\n\n# Csoportosítás: életkor-kategória szerint, arány számítása\npercentages = (\n    df_sub.groupby(age_col)[plan_col]\n    .apply(lambda x: x.isin(plan_values).mean() * 100)\n    .reindex(age_values)\n    .round(1)\n)\n\nfig, ax = plt.subplots(figsize=(8,3))\npercentages.plot(kind=\"bar\", ax=ax, color=\"#4477AA\")\nax.set_ylabel(\"Autóvásárlást tervezők aránya (%)\")\nax.set_xlabel(\"A legfiatalabb autó életkora a háztartásban\")\nax.set_title(\"Autóvásárlást tervezők aránya autóéletkor szerint\")\nax.set_ylim(0, 100)\n\nresult = fig"}
{"timestamp": "2026-01-19T06:47:39.185882", "previous_question": null, "user_input": "Melyik  legnépszerűbb gyorsétterem? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik  legnépszerűbb gyorsétterem? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T06:47:45.644131", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó egy márkát csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T06:48:00.602843", "previous_question": "Melyik  legnépszerűbb gyorsétterem? ", "user_input": "És a második?", "gate_decision": "FOLLOWUP", "rewritten_question": "Melyik az első és a második legnépszerűbb gyorsétterem?", "sent_to_ai": "Melyik az első és a második legnépszerűbb gyorsétterem?", "app": "Market research talk"}
{"timestamp": "2026-01-19T06:48:06.059846", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\ntop2 = counts.head(2).index.tolist()\n\nresult = (str(top2[0]), str(top2[1])) if len(top2) == 2 else tuple(top2)"}
{"timestamp": "2026-01-19T06:48:42.069036", "previous_question": "Melyik az első és a második legnépszerűbb gyorsétterem?", "user_input": "Rajzolj egy sávdiagramot, ami az gyorséttermek népszerűségét mutatja? ", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy sávdiagramot, amely az összes gyorsétterem népszerűségét mutatja!", "sent_to_ai": "Rajzolj egy sávdiagramot, amely az összes gyorsétterem népszerűségét mutatja!", "app": "Market research talk"}
{"timestamp": "2026-01-19T06:48:46.890320", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó egy márkát csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\n# Minden márka szerepeljen, ne csak a top N\ncounts_sorted = counts.sort_values()\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts_sorted.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(\"Gyorséttermek népszerűsége (penetráció, összes márka)\")\n\nresult = fig"}
{"timestamp": "2026-01-19T06:49:04.765325", "previous_question": "Rajzolj egy sávdiagramot, amely az összes gyorsétterem népszerűségét mutatja!", "user_input": "Rajzolj egy sávdiagramot, ami az uticélok népszerűségét mutatja? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj egy sávdiagramot, ami az uticélok népszerűségét mutatja? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T06:49:09.289187", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nTOP_N = 10\ncounts_top = counts.head(TOP_N).sort_values()\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts_top.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(f\"Külföldi utazási úti célok népszerűsége (Top {TOP_N})\")\n\nresult = fig"}
{"timestamp": "2026-01-19T06:49:14.627445", "previous_question": "Rajzolj egy sávdiagramot, ami az uticélok népszerűségét mutatja? ", "user_input": "Rajzolj egy sávdiagramot, ami az uticélok népszerűségét mutatja? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj egy sávdiagramot, ami az uticélok népszerűségét mutatja? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T06:49:19.606154", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nTOP_N = 10\ncounts_top = counts.head(TOP_N).sort_values()\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts_top.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(f\"Külföldi utazási úti célok népszerűsége (Top {TOP_N})\")\n\nresult = fig"}
{"timestamp": "2026-01-19T06:49:31.895000", "previous_question": "Rajzolj egy sávdiagramot, ami az uticélok népszerűségét mutatja? ", "user_input": "És a budapestiek körében?", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy sávdiagramot, ami az úti célok népszerűségét mutatja a budapestiek körében!", "sent_to_ai": "Rajzolj egy sávdiagramot, ami az úti célok népszerűségét mutatja a budapestiek körében!", "app": "Market research talk"}
{"timestamp": "2026-01-19T06:49:38.128643", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Szűrés: csak budapestiek\nlocation_col = \"Településtípus\"\ndf_sub = df[df[location_col] == \"Budapest\"].copy()\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df_sub[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nTOP_N = 10\ncounts_top = counts.head(TOP_N).sort_values()\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts_top.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(f\"Külföldi úti célok népszerűsége a budapestiek körében (Top {TOP_N})\")\n\nresult = fig"}
{"timestamp": "2026-01-19T06:50:41.841563", "previous_question": "Rajzolj egy sávdiagramot, ami az úti célok népszerűségét mutatja a budapestiek körében!", "user_input": "Rajzol vonaldiagramot, ami a népszerű uticélokat mutatja a budapestiek és nem budapestiek között!", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy vonaldiagramot, amely összehasonlítja a népszerű úti célokat a budapestiek és a nem budapestiek körében!", "sent_to_ai": "Rajzolj egy vonaldiagramot, amely összehasonlítja a népszerű úti célokat a budapestiek és a nem budapestiek körében!", "app": "Market research talk"}
{"timestamp": "2026-01-19T06:50:50.472332", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Mezők és paraméterek\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nlocation_col = \"Településtípus\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Budapestiek\ndf_budapest = df[df[location_col] == \"Budapest\"].copy()\nseries_budapest = df_budapest[col].dropna().apply(to_list)\nexploded_budapest = series_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_budapest = exploded_budapest.dropna()\nvalid_budapest = valid_budapest[~valid_budapest.isin(exclude_values)]\ndist_budapest = (\n    valid_budapest.value_counts(normalize=True)\n    .mul(100)\n    .round(1)\n)\n\n# Nem budapestiek\ndf_nonbp = df[df[location_col] != \"Budapest\"].copy()\nseries_nonbp = df_nonbp[col].dropna().apply(to_list)\nexploded_nonbp = series_nonbp.apply(lambda lst: list(set(lst))).explode()\nvalid_nonbp = exploded_nonbp.dropna()\nvalid_nonbp = valid_nonbp[~valid_nonbp.isin(exclude_values)]\ndist_nonbp = (\n    valid_nonbp.value_counts(normalize=True)\n    .mul(100)\n    .round(1)\n)\n\n# Közös top országok (összesített top 7)\nall_countries = pd.concat([dist_budapest, dist_nonbp], axis=1, keys=[\"Budapest\", \"Nem Budapest\"])\nall_countries[\"összes\"] = all_countries.sum(axis=1)\ntop_countries = all_countries[\"összes\"].sort_values(ascending=False).head(7).index.tolist()\n\n# Csak a top országokat ábrázoljuk, mindkét csoportban\nplot_df = pd.DataFrame({\n    \"Budapest\": dist_budapest.reindex(top_countries).fillna(0),\n    \"Nem Budapest\": dist_nonbp.reindex(top_countries).fillna(0)\n}, index=top_countries)\n\nfig, ax = plt.subplots(figsize=(8,4))\nplot_df.plot(kind=\"line\", marker=\"o\", ax=ax)\nax.set_ylabel(\"Arány (%)\")\nax.set_xlabel(\"Ország\")\nax.set_title(\"Külföldi úti célok népszerűsége: Budapestiek vs. nem budapestiek\")\nax.legend(title=\"Lakóhely\")\n\nresult = fig"}
{"timestamp": "2026-01-19T06:51:04.342772", "previous_question": "Rajzolj egy vonaldiagramot, amely összehasonlítja a népszerű úti célokat a budapestiek és a nem budapestiek körében!", "user_input": "Rajzol sávdiagramot, ami a népszerű uticélokat mutatja a budapestiek és nem budapestiek között!", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy sávdiagramot, amely összehasonlítja a népszerű úti célokat a budapestiek és a nem budapestiek körében!", "sent_to_ai": "Rajzolj egy sávdiagramot, amely összehasonlítja a népszerű úti célokat a budapestiek és a nem budapestiek körében!", "app": "Market research talk"}
{"timestamp": "2026-01-19T06:51:13.077358", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Paraméterek, mezőnevek\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nlocation_col = \"Településtípus\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Budapestiek\ndf_budapest = df[df[location_col] == \"Budapest\"].copy()\nseries_lists_budapest = df_budapest[col].dropna().apply(to_list)\nexploded_budapest = series_lists_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_budapest = exploded_budapest.dropna()\nvalid_budapest = valid_budapest[~valid_budapest.isin(exclude_values)]\ncounts_budapest = valid_budapest.value_counts()\n\n# Nem budapestiek\ndf_nonbp = df[df[location_col] != \"Budapest\"].copy()\nseries_lists_nonbp = df_nonbp[col].dropna().apply(to_list)\nexploded_nonbp = series_lists_nonbp.apply(lambda lst: list(set(lst))).explode()\nvalid_nonbp = exploded_nonbp.dropna()\nvalid_nonbp = valid_nonbp[~valid_nonbp.isin(exclude_values)]\ncounts_nonbp = valid_nonbp.value_counts()\n\n# Top 7 ország mindkét csoportban (összesített top 7)\nall_countries = pd.concat([counts_budapest, counts_nonbp]).groupby(level=0).sum()\ntop_countries = all_countries.head(7).index.tolist()\n\n# Adatok összeállítása\ndata = pd.DataFrame({\n    \"Budapestiek\": counts_budapest.reindex(top_countries, fill_value=0),\n    \"Nem budapestiek\": counts_nonbp.reindex(top_countries, fill_value=0)\n})\n\ndata = data.loc[top_countries]  # sorrend rögzítése\n\nfig, ax = plt.subplots(figsize=(8,4))\ndata.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"Ország\")\nax.set_title(\"Külföldi úti célok népszerűsége: Budapestiek vs. nem budapestiek\")\nax.legend(title=\"Csoport\")\n\nresult = fig"}
{"timestamp": "2026-01-19T07:42:22.487103", "previous_question": null, "user_input": "És\n", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "És\n", "app": "Market research talk"}
{"timestamp": "2026-01-19T07:42:31.829995", "generated_code": "Úgy tűnik, a kérdésed félbeszakadt: csak annyit írtál, hogy \"És\".  \nKérlek, írd le pontosan, mire vagy kíváncsi!  \nPéldául:  \n- \"És hányan járnak KFC-be?\"  \n- \"És mi a helyzet a férfiakkal?\"  \n- \"És rajzolj diagramot is!\"  \n\nÍrd le a teljes kérdést, hogy segíthessek!"}
{"timestamp": "2026-01-19T07:49:08.948419", "previous_question": null, "user_input": "Melyik a legnépszerűbb gyorsétterem? \n\n", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb gyorsétterem? \n\n", "app": "Market research talk"}
{"timestamp": "2026-01-19T07:49:13.732309", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó egy márkát csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T07:49:25.320270", "previous_question": "Melyik a legnépszerűbb gyorsétterem? \n\n", "user_input": "És a második? \n\n", "gate_decision": "FOLLOWUP", "rewritten_question": "Melyik a második legnépszerűbb gyorsétterem?", "sent_to_ai": "Melyik a második legnépszerűbb gyorsétterem?", "app": "Market research talk"}
{"timestamp": "2026-01-19T07:49:30.646513", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó márkánként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nif len(counts) >= 2:\n    result = str(counts.index[1])\nelse:\n    result = \"\""}
{"timestamp": "2026-01-19T07:52:47.076017", "previous_question": "Melyik a második legnépszerűbb gyorsétterem?", "user_input": "Rajzolj sávdiagramot, ami a legnépszerűbb uticélokat mutatja! \n\n\n", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj sávdiagramot, ami a legnépszerűbb uticélokat mutatja! \n\n\n", "app": "Market research talk"}
{"timestamp": "2026-01-19T07:52:53.593067", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\nTOP_N = 10\ncounts_top = counts.head(TOP_N).sort_values()\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts_top.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(f\"Legnépszerűbb külföldi úti célok (Top {TOP_N})\")\n\nresult = fig"}
{"timestamp": "2026-01-19T07:53:15.371795", "previous_question": "Rajzolj sávdiagramot, ami a legnépszerűbb uticélokat mutatja! \n\n\n", "user_input": "Rajzolj sávdiagramot, ami a legnépszerűbb uticélokat mutatja a nők és férfiak között! \n\n\n", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj sávdiagramot, ami a legnépszerűbb úti célokat mutatja külön a nők és a férfiak körében!", "sent_to_ai": "Rajzolj sávdiagramot, ami a legnépszerűbb úti célokat mutatja külön a nők és a férfiak körében!", "app": "Market research talk"}
{"timestamp": "2026-01-19T07:53:23.823440", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol_country = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\ncol_gender = \"Nem\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Először mindkét nemre külön eloszlás\ngenders = [\"Nő\", \"Férfi\"]\ncountry_counts = {}\n\nfor gender in genders:\n    df_sub = df[df[col_gender] == gender].copy()\n    series_lists = df_sub[col_country].dropna().apply(to_list)\n    exploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n    valid = exploded.dropna()\n    valid = valid[~valid.isin(exclude_values)]\n    counts = valid.value_counts()\n    country_counts[gender] = counts\n\n# Közös top 8 ország, mindkét nemnél előfordulók alapján\nall_countries = pd.concat([country_counts[\"Nő\"], country_counts[\"Férfi\"]])\ntop_countries = all_countries.groupby(all_countries.index).sum().sort_values(ascending=False).head(8).index.tolist()\n\n# Adatok DataFrame-be rendezése\ndata = {\n    \"Nő\": [country_counts[\"Nő\"].get(country, 0) for country in top_countries],\n    \"Férfi\": [country_counts[\"Férfi\"].get(country, 0) for country in top_countries],\n}\ndf_plot = pd.DataFrame(data, index=top_countries)\n\nfig, ax = plt.subplots(figsize=(8,4))\ndf_plot.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"Ország\")\nax.set_title(\"Legnépszerűbb külföldi úti célok nemenként (Top 8)\")\n\nresult = fig"}
{"timestamp": "2026-01-19T08:03:35.683265", "previous_question": null, "user_input": "Melyik a legnépszerűbb uticél? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb uticél? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T08:03:44.787128", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T08:07:02.355465", "previous_question": "Melyik a legnépszerűbb uticél? ", "user_input": "És a budapestiek  körében?", "gate_decision": "FOLLOWUP", "rewritten_question": "Melyik a legnépszerűbb úti cél a budapestiek körében?", "sent_to_ai": "Melyik a legnépszerűbb úti cél a budapestiek körében?", "app": "Market research talk"}
{"timestamp": "2026-01-19T08:07:10.370967", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Szűrés: budapestiek\nlocation_col = \"Településtípus\"\ncountry_col = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\n\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\ndf_sub = df[df[location_col] == \"Budapest\"].copy()\n\nseries_lists = df_sub[country_col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# exclude_values kiszűrése (entitás-elemzés)\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T08:11:29.125386", "previous_question": null, "user_input": "Rajzolj sávdiagramot ami mutatja a legnépszerűbb gyorséttermeket. \n", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj sávdiagramot ami mutatja a legnépszerűbb gyorséttermeket. \n", "app": "Market research talk"}
{"timestamp": "2026-01-19T08:11:35.033695", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó márkánként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nTOP_N = 10\ncounts_top = counts.head(TOP_N).sort_values()\n\nfig, ax = plt.subplots(figsize=(8, 4))\ncounts_top.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(f\"Gyorséttermek népszerűsége (Top {TOP_N})\")\n\nresult = fig"}
{"timestamp": "2026-01-19T08:11:59.377918", "previous_question": "Rajzolj sávdiagramot ami mutatja a legnépszerűbb gyorséttermeket. \n", "user_input": "És a nők között?", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj sávdiagramot, amely a legnépszerűbb gyorséttermeket mutatja a nők körében.", "sent_to_ai": "Rajzolj sávdiagramot, amely a legnépszerűbb gyorséttermeket mutatja a nők körében.", "app": "Market research talk"}
{"timestamp": "2026-01-19T08:12:05.689497", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\ngender_col = \"Nem\"\ngender_value = \"Nő\"\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Szűrés csak nőkre\ndf_sub = df[df[gender_col] == gender_value].copy()\n\nseries_lists = df_sub[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó márkánként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# exclude_values kiszűrése (entitás-elemzés)\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nTOP_N = 10\ncounts_top = counts.head(TOP_N).sort_values()\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts_top.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(f\"Legnépszerűbb gyorséttermek a nők körében (Top {TOP_N})\")\n\nresult = fig"}
{"timestamp": "2026-01-19T08:12:41.997085", "previous_question": "Rajzolj sávdiagramot, amely a legnépszerűbb gyorséttermeket mutatja a nők körében.", "user_input": "Nők és férfiak hány százaléka eszik csokoládét naponta? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Nők és férfiak hány százaléka eszik csokoládét naponta? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T08:12:47.909898", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\n\n# Kérdés: Nők és férfiak hány százaléka eszik csokoládét naponta?\n\ncol_gender = \"Nem\"\ncol_choco = \"Milyen gyakran fogyaszt Ön táblás csokoládét, csokoládészeletet?\"\ntarget_value = \"(szinte) minden nap\"\n\n# Csak a releváns nemek\ngenders = [\"Nő\", \"Férfi\"]\n\n# Eredmény tárolása\npercentages = {}\n\nfor gender in genders:\n    df_sub = df[df[col_gender] == gender]\n    total = df_sub[col_choco].notna().sum()\n    if total == 0:\n        percentages[gender] = 0.0\n    else:\n        count = (df_sub[col_choco] == target_value).sum()\n        percent = count / total * 100\n        percentages[gender] = round(percent, 1)\n\nimport pandas as pd\nresult = pd.Series(percentages, name=\"Naponta csokoládét fogyasztók aránya (%)\")"}
{"timestamp": "2026-01-19T08:45:36.016584", "previous_question": null, "user_input": "Melyik a legnépszerűbb gyorsétterem? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb gyorsétterem? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T08:45:43.986060", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó márkánként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T09:05:37.294076", "previous_question": null, "user_input": "Melyik a legnépszerűbb gyorsétterem? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb gyorsétterem? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T09:37:07.520976", "previous_question": null, "user_input": "Melyik a legnépszerűbb gyorsétterem? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb gyorsétterem? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T09:37:11.284980", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó egy márkát csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T09:37:38.817611", "previous_question": "Melyik a legnépszerűbb gyorsétterem? ", "user_input": "Rajzolj egy sávdiagramot, ami mutatja a legnépszerűbb gyorséttermeket", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy sávdiagramot, amely bemutatja a legnépszerűbb gyorséttermeket.", "sent_to_ai": "Rajzolj egy sávdiagramot, amely bemutatja a legnépszerűbb gyorséttermeket.", "app": "Market research talk"}
{"timestamp": "2026-01-19T09:37:43.948269", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó márkánként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nTOP_N = 10\ncounts_top = counts.head(TOP_N).sort_values()\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts_top.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(f\"Gyorséttermek népszerűsége (Top {TOP_N})\")\n\nresult = fig"}
{"timestamp": "2026-01-19T09:38:15.424042", "previous_question": "Rajzolj egy sávdiagramot, amely bemutatja a legnépszerűbb gyorséttermeket.", "user_input": "Rajzolj egy sávdiagramot, ami mutatja a legnépszerűbb külföldi uticélokat budapestiek és nem budapestiek körében? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj egy sávdiagramot, ami mutatja a legnépszerűbb külföldi uticélokat budapestiek és nem budapestiek körében? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T09:38:22.812527", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Mezők és paraméterek\ncity_col = \"Településtípus\"\ncountry_col = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Budapestiek\ndf_budapest = df[df[city_col] == \"Budapest\"].copy()\nseries_budapest = df_budapest[country_col].dropna().apply(to_list)\nexploded_budapest = series_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_budapest = exploded_budapest.dropna()\nvalid_budapest = valid_budapest[~valid_budapest.isin(exclude_values)]\ncounts_budapest = valid_budapest.value_counts().head(7)\n\n# Nem budapestiek\ndf_nonbp = df[df[city_col] != \"Budapest\"].copy()\nseries_nonbp = df_nonbp[country_col].dropna().apply(to_list)\nexploded_nonbp = series_nonbp.apply(lambda lst: list(set(lst))).explode()\nvalid_nonbp = exploded_nonbp.dropna()\nvalid_nonbp = valid_nonbp[~valid_nonbp.isin(exclude_values)]\ncounts_nonbp = valid_nonbp.value_counts().head(7)\n\n# Közös országlista a két csoport top7-jéből\nall_countries = list(set(counts_budapest.index).union(set(counts_nonbp.index)))\n# Megőrizzük a sorrendet: először budapestiek top, aztán nem budapestiek top, duplikáció nélkül\nordered_countries = []\nfor c in list(counts_budapest.index) + list(counts_nonbp.index):\n    if c not in ordered_countries:\n        ordered_countries.append(c)\n\n# Adatok DataFrame-be\nimport pandas as pd\ndata = {\n    \"Budapestiek\": counts_budapest.reindex(ordered_countries).fillna(0).astype(int),\n    \"Nem budapestiek\": counts_nonbp.reindex(ordered_countries).fillna(0).astype(int),\n}\ndf_plot = pd.DataFrame(data, index=ordered_countries)\n\n# Ábra\nfig, ax = plt.subplots(figsize=(8,5))\ndf_plot.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"Ország\")\nax.set_title(\"Legnépszerűbb külföldi úti célok\\nBudapestiek és nem budapestiek körében\")\nax.legend(title=\"Lakóhely\")\n\nresult = fig"}
{"timestamp": "2026-01-19T09:39:09.617524", "previous_question": "Rajzolj egy sávdiagramot, ami mutatja a legnépszerűbb külföldi uticélokat budapestiek és nem budapestiek körében? ", "user_input": "A férfiak és a nők hány százaléka eszik naponta csokoládét? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "A férfiak és a nők hány százaléka eszik naponta csokoládét? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T09:39:13.586664", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\ncol_gender = \"Nem\"\ncol_choco = \"Milyen gyakran fogyaszt Ön táblás csokoládét, csokoládészeletet?\"\ntarget_value = \"(szinte) minden nap\"\n\n# Csak azokat, akiknél mindkét adat megvan\ndf_valid = df[[col_gender, col_choco]].dropna()\n\n# Férfiak\ndf_male = df_valid[df_valid[col_gender] == \"Férfi\"]\npct_male = (\n    (df_male[col_choco] == target_value).sum() / len(df_male) * 100\n    if len(df_male) > 0 else 0.0\n)\n\n# Nők\ndf_female = df_valid[df_valid[col_gender] == \"Nő\"]\npct_female = (\n    (df_female[col_choco] == target_value).sum() / len(df_female) * 100\n    if len(df_female) > 0 else 0.0\n)\n\nresult = {\n    \"Férfiak (%)\": round(pct_male, 1),\n    \"Nők (%)\": round(pct_female, 1)\n}"}
{"timestamp": "2026-01-19T09:46:34.681101", "previous_question": null, "user_input": "A férfiak és a nők hány százaléka eszik naponta csokoládét? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "A férfiak és a nők hány százaléka eszik naponta csokoládét? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T09:46:38.717548", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\ncol_gender = \"Nem\"\ncol_choco = \"Milyen gyakran fogyaszt Ön táblás csokoládét, csokoládészeletet?\"\ntarget_value = \"(szinte) minden nap\"\n\n# Csak azokat, akiknél mindkét adat elérhető\ndf_valid = df[[col_gender, col_choco]].dropna()\n\n# Csoportosítás nemenként\npercentages = (\n    df_valid.groupby(col_gender)[col_choco]\n    .apply(lambda s: (s == target_value).mean() * 100)\n    .round(1)\n)\n\nresult = percentages"}
{"timestamp": "2026-01-19T09:47:10.212169", "previous_question": "A férfiak és a nők hány százaléka eszik naponta csokoládét? ", "user_input": "És hányan nem esznek csokoládét? ", "gate_decision": "FOLLOWUP", "rewritten_question": "A férfiak és a nők hány százaléka eszik, illetve nem eszik naponta csokoládét?", "sent_to_ai": "A férfiak és a nők hány százaléka eszik, illetve nem eszik naponta csokoládét?", "app": "Market research talk"}
{"timestamp": "2026-01-19T09:47:16.280034", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\ncol_gender = \"Nem\"\ncol_choco = \"Milyen gyakran fogyaszt Ön táblás csokoládét, csokoládészeletet?\"\n\n# Értékek a META alapján\nDAILY = \"(szinte) minden nap\"\n\n# Csak a két nemmel dolgozunk\ngenders = [\"Férfi\", \"Nő\"]\n\n# Eredmény tárolása\ndata = []\n\nfor gender in genders:\n    df_sub = df[df[col_gender] == gender]\n    n = len(df_sub)\n    if n == 0:\n        pct_daily = 0.0\n        pct_not_daily = 0.0\n    else:\n        n_daily = (df_sub[col_choco] == DAILY).sum()\n        pct_daily = n_daily / n * 100\n        pct_not_daily = 100 - pct_daily\n    data.append({\n        \"Nem\": gender,\n        \"Naponta eszik csokoládét (%)\": round(pct_daily, 1),\n        \"Nem eszik naponta csokoládét (%)\": round(pct_not_daily, 1)\n    })\n\nimport pandas as pd\nresult = pd.DataFrame(data).set_index(\"Nem\")"}
{"timestamp": "2026-01-19T09:47:42.301119", "previous_question": "A férfiak és a nők hány százaléka eszik, illetve nem eszik naponta csokoládét?", "user_input": "Hányan nem esznek egyáltalán csokoládét? ", "gate_decision": "FOLLOWUP", "rewritten_question": "A férfiak és a nők közül hányan nem esznek egyáltalán csokoládét, illetve hány százalékuk eszik vagy nem eszik naponta csokoládét?", "sent_to_ai": "A férfiak és a nők közül hányan nem esznek egyáltalán csokoládét, illetve hány százalékuk eszik vagy nem eszik naponta csokoládét?", "app": "Market research talk"}
{"timestamp": "2026-01-19T09:47:48.544898", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\ncol_choco = \"Milyen gyakran fogyaszt Ön táblás csokoládét, csokoládészeletet?\"\ncol_gender = \"Nem\"\n\n# Értékkészlet a META alapján:\nnever = \"sosem fogyasztom\"\ndaily = \"(szinte) minden nap\"\n\n# Eredmény tárolása\nsummary = {}\n\nfor gender in [\"Férfi\", \"Nő\"]:\n    df_sub = df[df[col_gender] == gender].copy()\n    n = len(df_sub)\n    n_never = int((df_sub[col_choco] == never).sum())\n    n_daily = int((df_sub[col_choco] == daily).sum())\n    pct_never = round(n_never / n * 100, 1) if n > 0 else 0.0\n    pct_daily = round(n_daily / n * 100, 1) if n > 0 else 0.0\n    summary[gender] = {\n        \"összesen\": n,\n        \"sosem fogyasztók (fő)\": n_never,\n        \"sosem fogyasztók (%)\": pct_never,\n        \"naponta fogyasztók (fő)\": n_daily,\n        \"naponta fogyasztók (%)\": pct_daily,\n    }\n\nimport pandas as pd\nresult = pd.DataFrame(summary).T[\n    [\"összesen\", \"sosem fogyasztók (fő)\", \"sosem fogyasztók (%)\", \"naponta fogyasztók (fő)\", \"naponta fogyasztók (%)\"]\n]"}
{"timestamp": "2026-01-19T09:49:29.130491", "previous_question": "A férfiak és a nők közül hányan nem esznek egyáltalán csokoládét, illetve hány százalékuk eszik vagy nem eszik naponta csokoládét?", "user_input": "Rajzolj sávdiagramot, hogy milyen meghajtású autói vannak az embereknek? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj sávdiagramot, hogy milyen meghajtású autói vannak az embereknek? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T09:49:31.945402", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\n\ncol = \"Milyen meghajtású az Ön vagy családja által leggyakrabban használt autó?\"\n\ndist = (\n    df[col]\n    .dropna()\n    .value_counts(normalize=True)\n    .mul(100)\n    .round(1)\n)\n\nfig, ax = plt.subplots(figsize=(8,3))\ndist.plot(kind=\"bar\", ax=ax)\nax.set_ylabel(\"Százalék (%)\")\nax.set_xlabel(\"\")\nax.set_title(\"Autók meghajtástípus szerinti megoszlása\")\n\nresult = fig"}
{"timestamp": "2026-01-19T10:18:57.751414", "previous_question": null, "user_input": "Melyik a legnépszerűbb külföldi uticél?", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb külföldi uticél?", "app": "Market research talk"}
{"timestamp": "2026-01-19T10:19:02.850648", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T10:19:22.065192", "previous_question": "Melyik a legnépszerűbb külföldi uticél?", "user_input": "És a budapestiek körében? ", "gate_decision": "FOLLOWUP", "rewritten_question": "Melyik a legnépszerűbb külföldi úti cél a budapestiek körében?", "sent_to_ai": "Melyik a legnépszerűbb külföldi úti cél a budapestiek körében?", "app": "Market research talk"}
{"timestamp": "2026-01-19T10:19:29.175919", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Szűrés: csak budapestiek\nlocation_col = \"Településtípus\"\ncountry_col = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\n\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\ndf_sub = df[df[location_col] == \"Budapest\"].copy()\n\nseries_lists = df_sub[country_col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# exclude_values kiszűrése (entitás-elemzés)\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T10:20:09.696923", "previous_question": "Melyik a legnépszerűbb külföldi úti cél a budapestiek körében?", "user_input": "Rajzolj egy sávdiagramot ami a legnépszerűbb uticélokat mutatja a budapestiek és nem budapestiek körében!", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj egy sávdiagramot ami a legnépszerűbb uticélokat mutatja a budapestiek és nem budapestiek körében!", "app": "Market research talk"}
{"timestamp": "2026-01-19T10:20:18.083293", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\nlocation_col = \"Településtípus\"\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Budapestiek\ndf_budapest = df[df[location_col] == \"Budapest\"].copy()\nseries_lists_budapest = df_budapest[col].dropna().apply(to_list)\nexploded_budapest = series_lists_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_budapest = exploded_budapest.dropna()\nvalid_budapest = valid_budapest[~valid_budapest.isin(exclude_values)]\ncounts_budapest = valid_budapest.value_counts().head(7)\n\n# Nem budapestiek\ndf_nonbp = df[df[location_col] != \"Budapest\"].copy()\nseries_lists_nonbp = df_nonbp[col].dropna().apply(to_list)\nexploded_nonbp = series_lists_nonbp.apply(lambda lst: list(set(lst))).explode()\nvalid_nonbp = exploded_nonbp.dropna()\nvalid_nonbp = valid_nonbp[~valid_nonbp.isin(exclude_values)]\ncounts_nonbp = valid_nonbp.value_counts().head(7)\n\n# Közös országlista a két csoport top7-jéből\nall_countries = list(set(counts_budapest.index).union(set(counts_nonbp.index)))\n\n# Két csoport számait egy DataFrame-be\nimport pandas as pd\ndata = {\n    \"Budapestiek\": [counts_budapest.get(c, 0) for c in all_countries],\n    \"Nem budapestiek\": [counts_nonbp.get(c, 0) for c in all_countries],\n}\ndf_plot = pd.DataFrame(data, index=all_countries)\n\ndf_plot = df_plot.sort_values(\"Budapestiek\", ascending=True)\n\nfig, ax = plt.subplots(figsize=(9,5))\ndf_plot.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"Ország\")\nax.set_title(\"Legnépszerűbb külföldi úti célok: Budapestiek vs. nem budapestiek\")\nax.legend(title=\"Csoport\")\n\nresult = fig"}
{"timestamp": "2026-01-19T12:11:12.539786", "previous_question": null, "user_input": "Melyik a legnépszerűbb gyorsétterem?\n", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb gyorsétterem?\n", "app": "Market research talk"}
{"timestamp": "2026-01-19T12:11:24.149757", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó egy márkát csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T13:03:22.303427", "previous_question": null, "user_input": "Melyik legnépszerűbb gyorsétterem? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik legnépszerűbb gyorsétterem? ", "app": "Market research talk"}
{"timestamp": "2026-01-19T13:03:27.961860", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó márkánként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T13:04:15.344086", "previous_question": "Melyik legnépszerűbb gyorsétterem? ", "user_input": "Rajzolj egy sávdiagramot, ami a legnépszerűbb gyorséttermeket mutatja! ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj egy sávdiagramot, ami a legnépszerűbb gyorséttermeket mutatja! ", "app": "Market research talk"}
{"timestamp": "2026-01-19T13:04:21.240412", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó egy márkát csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nTOP_N = 10\ncounts_top = counts.head(TOP_N).sort_values()\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts_top.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(f\"Legnépszerűbb gyorséttermek (Top {TOP_N})\")\n\nresult = fig"}
{"timestamp": "2026-01-19T13:04:55.064674", "previous_question": "Rajzolj egy sávdiagramot, ami a legnépszerűbb gyorséttermeket mutatja! ", "user_input": "Rajzold meg ezt a férfiakra és a nőkre külön! ", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy sávdiagramot, amely a legnépszerűbb gyorséttermeket mutatja, külön a férfiakra és a nőkre!", "sent_to_ai": "Rajzolj egy sávdiagramot, amely a legnépszerűbb gyorséttermeket mutatja, külön a férfiakra és a nőkre!", "app": "Market research talk"}
{"timestamp": "2026-01-19T13:05:04.559831", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\ngender_col = \"Nem\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Férfiak\ndf_male = df[df[gender_col] == \"Férfi\"].copy()\nseries_lists_male = df_male[col].dropna().apply(to_list)\nexploded_male = series_lists_male.apply(lambda lst: list(set(lst))).explode()\nvalid_male = exploded_male.dropna()\nvalid_male = valid_male[~valid_male.isin(exclude_values)]\ncounts_male = valid_male.value_counts()\n\n# Nők\ndf_female = df[df[gender_col] == \"Nő\"].copy()\nseries_lists_female = df_female[col].dropna().apply(to_list)\nexploded_female = series_lists_female.apply(lambda lst: list(set(lst))).explode()\nvalid_female = exploded_female.dropna()\nvalid_female = valid_female[~valid_female.isin(exclude_values)]\ncounts_female = valid_female.value_counts()\n\n# Közös top 7 márka (mindkét nemnél előforduló leggyakoribbak)\ntop_brands = (\n    (counts_male + counts_female)\n    .sort_values(ascending=False)\n    .head(7)\n    .index.tolist()\n)\n\nmale_top = counts_male.reindex(top_brands, fill_value=0)\nfemale_top = counts_female.reindex(top_brands, fill_value=0)\n\ndf_plot = (\n    pd.DataFrame({\n        \"Férfiak\": male_top,\n        \"Nők\": female_top\n    })\n)\n\nfig, ax = plt.subplots(figsize=(8,4))\ndf_plot.plot(kind=\"barh\", ax=ax, color=[\"#1f77b4\", \"#e377c2\"])\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(\"Legnépszerűbb gyorséttermek nemenként\")\nax.legend(title=\"Nem\")\n\nresult = fig"}
{"timestamp": "2026-01-19T13:06:33.916941", "previous_question": "Rajzolj egy sávdiagramot, amely a legnépszerűbb gyorséttermeket mutatja, külön a férfiakra és a nőkre!", "user_input": "Melyik a legnépszerűbb külföldi úti cél?\n", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb külföldi úti cél?\n", "app": "Market research talk"}
{"timestamp": "2026-01-19T13:06:38.823053", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-19T13:07:21.008703", "previous_question": "Melyik a legnépszerűbb külföldi úti cél?\n", "user_input": "Rajzolj sávdiagramot, ami a legnépszerűbb külföldi utacérokat mutatja budapestiekre és nem budapestiekre.\n", "gate_decision": "FOLLOWUP", "rewritten_question": "Készíts egy sávdiagramot, amely bemutatja a legnépszerűbb külföldi úti célokat a budapestiek és a nem budapestiek körében.", "sent_to_ai": "Készíts egy sávdiagramot, amely bemutatja a legnépszerűbb külföldi úti célokat a budapestiek és a nem budapestiek körében.", "app": "Market research talk"}
{"timestamp": "2026-01-19T13:07:36.303154", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Mezők és paraméterek\nlocation_col = \"Településtípus\"\ncountry_col = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Budapestiek\ndf_budapest = df[df[location_col] == \"Budapest\"].copy()\nseries_budapest = df_budapest[country_col].dropna().apply(to_list)\nexploded_budapest = series_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_budapest = exploded_budapest.dropna()\nvalid_budapest = valid_budapest[~valid_budapest.isin(exclude_values)]\ncounts_budapest = valid_budapest.value_counts().head(7)\n\n# Nem budapestiek\ndf_nonbp = df[df[location_col] != \"Budapest\"].copy()\nseries_nonbp = df_nonbp[country_col].dropna().apply(to_list)\nexploded_nonbp = series_nonbp.apply(lambda lst: list(set(lst))).explode()\nvalid_nonbp = exploded_nonbp.dropna()\nvalid_nonbp = valid_nonbp[~valid_nonbp.isin(exclude_values)]\ncounts_nonbp = valid_nonbp.value_counts().head(7)\n\n# Közös országlista a két csoport top7-jéből\nall_countries = list(set(counts_budapest.index).union(set(counts_nonbp.index)))\n\n# Mindkét csoportot azonos sorrendbe rendezni (összesített top szerint)\ntotal_counts = (counts_budapest.add(counts_nonbp, fill_value=0)).sort_values(ascending=False)\ncountries_sorted = total_counts.index.tolist()\n\n# Adatok DataFrame-be\nimport pandas as pd\ndata = pd.DataFrame({\n    \"Budapestiek\": counts_budapest,\n    \"Nem budapestiek\": counts_nonbp\n}).reindex(countries_sorted).fillna(0).astype(int)\n\nfig, ax = plt.subplots(figsize=(8,4))\ndata.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(\"Legnépszerűbb külföldi úti célok: Budapestiek vs. nem budapestiek\")\nax.legend(title=\"Lakóhely\")\n\nresult = fig"}
{"timestamp": "2026-01-19T13:11:40.019565", "previous_question": "Készíts egy sávdiagramot, amely bemutatja a legnépszerűbb külföldi úti célokat a budapestiek és a nem budapestiek körében.", "user_input": "Melyik a legnépszerűbb üticél?", "gate_decision": "FOLLOWUP", "rewritten_question": "Melyik a legnépszerűbb külföldi úti cél a budapestiek és a nem budapestiek körében, sávdiagramon bemutatva?", "sent_to_ai": "Melyik a legnépszerűbb külföldi úti cél a budapestiek és a nem budapestiek körében, sávdiagramon bemutatva?", "app": "Market research talk"}
{"timestamp": "2026-01-19T13:11:46.740449", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# META alapján\ncol_region = \"Településtípus\"\ncol_country = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Budapestiek\ndf_budapest = df[df[col_region] == \"Budapest\"].copy()\nseries_lists_budapest = df_budapest[col_country].dropna().apply(to_list)\nexploded_budapest = series_lists_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_budapest = exploded_budapest.dropna()\nvalid_budapest = valid_budapest[~valid_budapest.isin(exclude_values)]\ncounts_budapest = valid_budapest.value_counts()\n\n# Nem budapestiek\ndf_non_budapest = df[df[col_region] != \"Budapest\"].copy()\nseries_lists_non_budapest = df_non_budapest[col_country].dropna().apply(to_list)\nexploded_non_budapest = series_lists_non_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_non_budapest = exploded_non_budapest.dropna()\nvalid_non_budapest = valid_non_budapest[~valid_non_budapest.isin(exclude_values)]\ncounts_non_budapest = valid_non_budapest.value_counts()\n\n# Közös országlista (top 5-5, hogy ne legyen túl hosszú a diagram)\ntop_budapest = counts_budapest.head(5)\ntop_non_budapest = counts_non_budapest.head(5)\nall_countries = list(set(top_budapest.index).union(set(top_non_budapest.index)))\n\n# Adatok összeállítása\nbudapest_vals = [counts_budapest.get(country, 0) for country in all_countries]\nnon_budapest_vals = [counts_non_budapest.get(country, 0) for country in all_countries]\n\nx = range(len(all_countries))\nwidth = 0.35\n\nfig, ax = plt.subplots(figsize=(8,4))\nax.barh([i + width/2 for i in x], budapest_vals, height=width, label=\"Budapestiek\")\nax.barh([i - width/2 for i in x], non_budapest_vals, height=width, label=\"Nem budapestiek\")\n\nax.set_yticks(x)\nax.set_yticklabels(all_countries)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_title(\"Legnépszerűbb külföldi úti célok – Budapestiek vs. nem budapestiek\")\nax.legend()\n\nresult = fig"}
{"timestamp": "2026-01-20T12:11:45.228513", "previous_question": null, "user_input": "Melyik a legnépszerűbb gyorsétterem?", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb gyorsétterem?", "app": "Market research talk"}
{"timestamp": "2026-01-20T12:11:51.889479", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó egy márkát csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-20T12:12:19.137796", "previous_question": "Melyik a legnépszerűbb gyorsétterem?", "user_input": "Melyik a legnépszerűbb uticél?", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb uticél?", "app": "Market research talk"}
{"timestamp": "2026-01-20T12:12:24.857340", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-20T12:12:46.291695", "previous_question": "Melyik a legnépszerűbb uticél?", "user_input": "Melyik a legnépszerűbb uticél budapestiek és nem budapestiek körében?", "gate_decision": "FOLLOWUP", "rewritten_question": "Melyik a legnépszerűbb úti cél a budapestiek és a nem budapestiek körében külön-külön?", "sent_to_ai": "Melyik a legnépszerűbb úti cél a budapestiek és a nem budapestiek körében külön-külön?", "app": "Market research talk"}
{"timestamp": "2026-01-20T12:12:54.052829", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Változók\nLOCATION_COL = \"Településtípus\"\nCOUNTRY_COL = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\n\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Budapestiek\ndf_budapest = df[df[LOCATION_COL] == \"Budapest\"].copy()\nseries_lists_budapest = df_budapest[COUNTRY_COL].dropna().apply(to_list)\nexploded_budapest = series_lists_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_budapest = exploded_budapest.dropna()\nvalid_budapest = valid_budapest[~valid_budapest.isin(exclude_values)]\ncounts_budapest = valid_budapest.value_counts()\ntop_budapest = str(counts_budapest.idxmax()) if len(counts_budapest) else \"\"\n\n# Nem budapestiek\ndf_nonbp = df[df[LOCATION_COL] != \"Budapest\"].copy()\nseries_lists_nonbp = df_nonbp[COUNTRY_COL].dropna().apply(to_list)\nexploded_nonbp = series_lists_nonbp.apply(lambda lst: list(set(lst))).explode()\nvalid_nonbp = exploded_nonbp.dropna()\nvalid_nonbp = valid_nonbp[~valid_nonbp.isin(exclude_values)]\ncounts_nonbp = valid_nonbp.value_counts()\ntop_nonbp = str(counts_nonbp.idxmax()) if len(counts_nonbp) else \"\"\n\nresult = {\n    \"Budapestiek legnépszerűbb úti célja\": top_budapest,\n    \"Nem budapestiek legnépszerűbb úti célja\": top_nonbp\n}"}
{"timestamp": "2026-01-20T12:13:34.496476", "previous_question": "Melyik a legnépszerűbb úti cél a budapestiek és a nem budapestiek körében külön-külön?", "user_input": "Rajzolj egy sávdiagramot mi  legnépszerűbb uricél a budapestiek és nem budapestiek körében", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj egy sávdiagramot mi  legnépszerűbb uricél a budapestiek és nem budapestiek körében", "app": "Market research talk"}
{"timestamp": "2026-01-20T12:13:43.938328", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Mezők és paraméterek\ncity_col = \"Településtípus\"\ncountry_col = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\n\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Budapestiek\ndf_budapest = df[df[city_col] == \"Budapest\"].copy()\nseries_lists_budapest = df_budapest[country_col].dropna().apply(to_list)\nexploded_budapest = series_lists_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_budapest = exploded_budapest.dropna()\nvalid_budapest = valid_budapest[~valid_budapest.isin(exclude_values)]\ncounts_budapest = valid_budapest.value_counts()\ntop_budapest = counts_budapest.head(1)\n\n# Nem budapestiek\ndf_nonbp = df[df[city_col] != \"Budapest\"].copy()\nseries_lists_nonbp = df_nonbp[country_col].dropna().apply(to_list)\nexploded_nonbp = series_lists_nonbp.apply(lambda lst: list(set(lst))).explode()\nvalid_nonbp = exploded_nonbp.dropna()\nvalid_nonbp = valid_nonbp[~valid_nonbp.isin(exclude_values)]\ncounts_nonbp = valid_nonbp.value_counts()\ntop_nonbp = counts_nonbp.head(1)\n\n# Diagram adatok összeállítása\nlabels = [\"Budapestiek\", \"Nem budapestiek\"]\ntop_countries = [top_budapest.index[0] if len(top_budapest) else \"\", top_nonbp.index[0] if len(top_nonbp) else \"\"]\ntop_counts = [int(top_budapest.iloc[0]) if len(top_budapest) else 0, int(top_nonbp.iloc[0]) if len(top_nonbp) else 0]\n\nfig, ax = plt.subplots(figsize=(8,3))\nbars = ax.bar(labels, top_counts, color=[\"#1f77b4\", \"#ff7f0e\"])\nfor i, (country, count) in enumerate(zip(top_countries, top_counts)):\n    ax.text(i, count + max(top_counts)*0.02, f\"{country}\\n({count} fő)\", ha=\"center\", va=\"bottom\", fontsize=11)\n\nax.set_ylabel(\"Válaszadók száma\")\nax.set_title(\"Legnépszerűbb külföldi úti cél a budapestiek és nem budapestiek körében\")\n\nresult = fig"}
{"timestamp": "2026-01-20T12:14:09.026601", "previous_question": "Rajzolj egy sávdiagramot mi  legnépszerűbb uricél a budapestiek és nem budapestiek körében", "user_input": "Rajzolj egy sávdiagramot mi  legnépszerűbb gyorsétterem a budapestiek és nem budapestiek körében", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj egy sávdiagramot mi  legnépszerűbb gyorsétterem a budapestiek és nem budapestiek körében", "app": "Market research talk"}
{"timestamp": "2026-01-20T12:14:20.152458", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nlocation_col = \"Településtípus\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Budapestiek\ndf_budapest = df[df[location_col] == \"Budapest\"].copy()\nseries_budapest = df_budapest[col].dropna().apply(to_list)\nexploded_budapest = series_budapest.apply(lambda lst: list(set(lst))).explode()\nvalid_budapest = exploded_budapest.dropna()\nvalid_budapest = valid_budapest[~valid_budapest.isin(exclude_values)]\ncounts_budapest = valid_budapest.value_counts()\ntop_budapest = counts_budapest.head(1)\n\n# Nem budapestiek\ndf_nonbp = df[df[location_col] != \"Budapest\"].copy()\nseries_nonbp = df_nonbp[col].dropna().apply(to_list)\nexploded_nonbp = series_nonbp.apply(lambda lst: list(set(lst))).explode()\nvalid_nonbp = exploded_nonbp.dropna()\nvalid_nonbp = valid_nonbp[~valid_nonbp.isin(exclude_values)]\ncounts_nonbp = valid_nonbp.value_counts()\ntop_nonbp = counts_nonbp.head(1)\n\n# Közös sávdiagram\nlabels = [\"Budapestiek\", \"Nem budapestiek\"]\nfastfood_names = [top_budapest.index[0] if len(top_budapest) else \"\", top_nonbp.index[0] if len(top_nonbp) else \"\"]\nvalues = [int(top_budapest.iloc[0]) if len(top_budapest) else 0, int(top_nonbp.iloc[0]) if len(top_nonbp) else 0]\n\nfig, ax = plt.subplots(figsize=(7,3))\nbars = ax.bar(labels, values, color=[\"#1f77b4\", \"#ff7f0e\"])\n\n# Felirat a sávokra: gyorsétterem neve\nfor bar, name in zip(bars, fastfood_names):\n    ax.text(bar.get_x() + bar.get_width()/2, bar.get_height() + max(values)*0.01, name, ha='center', va='bottom', fontsize=11, fontweight=\"bold\")\n\nax.set_ylabel(\"Válaszadók száma\")\nax.set_title(\"Legnépszerűbb gyorsétterem a budapestiek és nem budapestiek körében\")\n\nresult = fig"}
{"timestamp": "2026-01-20T12:15:21.021861", "previous_question": "Rajzolj egy sávdiagramot mi  legnépszerűbb gyorsétterem a budapestiek és nem budapestiek körében", "user_input": "Melyik a legnépszerűbb uticél a nők körében akik 45-és 60 éves kor között vannak", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Melyik a legnépszerűbb uticél a nők körében akik 45-és 60 éves kor között vannak", "app": "Market research talk"}
{"timestamp": "2026-01-20T12:15:27.733720", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\n# Paraméterek\ngender_col = \"Nem\"\nage_col = \"Korkategória\"\ncountry_col = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\n\n# Korkategóriák a 45-60 év közötti nők kiválasztásához\nage_values = [\"40-49 éves\", \"50-59 éves\"]\n\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Szűrés: nők, 45-60 év között (azaz 40-49 és 50-59 éves kategóriák)\ndf_sub = df[\n    (df[gender_col] == \"Nő\") &\n    (df[age_col].isin(age_values))\n].copy()\n\nseries_lists = df_sub[country_col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# exclude_values kiszűrése (entitás-elemzés)\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nresult = str(counts.idxmax()) if len(counts) else \"\""}
{"timestamp": "2026-01-20T12:24:36.578407", "previous_question": "Melyik a legnépszerűbb uticél a nők körében akik 45-és 60 éves kor között vannak", "user_input": "Rajzolj sávdiagramot, ami mutatja az összes gyorsétterem népszerűségét", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj sávdiagramot, ami mutatja az összes gyorsétterem népszerűségét", "app": "Market research talk"}
{"timestamp": "2026-01-20T12:24:46.919331", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"A következő gyorsétterem láncok közül melyikben étkezett az elmúlt 1 évben?\"\nexclude_values = [\n    \"Egyikben sem étkeztem az elmúlt 1 évben, de régebben igen\",\n    \"Ezek közül egyik gyorsétterem láncot sem ismerem\",\n    \"Sohasem étkeztem ezekben a gyorséttermekben\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level penetráció: egy válaszadó egy márkát csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts().sort_values(ascending=True)\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(\"Gyorséttermek népszerűsége (összes márka)\")\n\nresult = fig"}
{"timestamp": "2026-01-20T12:25:25.023244", "previous_question": "Rajzolj sávdiagramot, ami mutatja az összes gyorsétterem népszerűségét", "user_input": "Rajzolj egy sávdiagramot, ami az uticélok népszerűségét mutatja.\n", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj egy sávdiagramot, ami az uticélok népszerűségét mutatja.\n", "app": "Market research talk"}
{"timestamp": "2026-01-20T12:25:31.197496", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\nseries_lists = df[col].dropna().apply(to_list)\n\n# respondent-level: egy válaszadó országonként csak egyszer számítson\nexploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n\n# entitás-elemzés: exclude_values kiszűrése\nvalid = exploded.dropna()\nvalid = valid[~valid.isin(exclude_values)]\n\ncounts = valid.value_counts()\n\nTOP_N = 10\ncounts_top = counts.head(TOP_N).sort_values()\n\nfig, ax = plt.subplots(figsize=(8,4))\ncounts_top.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"\")\nax.set_title(f\"Külföldi utazási úti célok népszerűsége (Top {TOP_N})\")\n\nresult = fig"}
{"timestamp": "2026-01-20T12:25:51.121808", "previous_question": "Rajzolj egy sávdiagramot, ami az uticélok népszerűségét mutatja.\n", "user_input": "Rajzolt külön meg a férfiakra és nőkre.\n", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy sávdiagramot, amely az úti célok népszerűségét mutatja külön a férfiak és a nők körében.", "sent_to_ai": "Rajzolj egy sávdiagramot, amely az úti célok népszerűségét mutatja külön a férfiak és a nők körében.", "app": "Market research talk"}
{"timestamp": "2026-01-20T12:25:58.969857", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport matplotlib.pyplot as plt\nimport ast\n\ncol = \"Melyik országba tervezi ezt a külföldi utazást ezen a nyáron?\"\ngender_col = \"Nem\"\nexclude_values = [\n    \"Még nem döntöttem, döntöttük el, hogy melyik országba megyek / megyünk nyaralni\",\n    \"Nem tervezek külföldi utazást\",\n]\n\ndef to_list(x):\n    if isinstance(x, list):\n        return x\n    if isinstance(x, str):\n        s = x.strip()\n        if s.startswith(\"[\") and s.endswith(\"]\"):\n            try:\n                v = ast.literal_eval(s)\n                if isinstance(v, list):\n                    return v\n            except Exception:\n                pass\n        return [x]\n    return []\n\n# Külön eloszlás férfiakra és nőkre\ndata = {}\nfor gender in [\"Férfi\", \"Nő\"]:\n    df_sub = df[df[gender_col] == gender].copy()\n    series_lists = df_sub[col].dropna().apply(to_list)\n    exploded = series_lists.apply(lambda lst: list(set(lst))).explode()\n    valid = exploded.dropna()\n    valid = valid[~valid.isin(exclude_values)]\n    counts = valid.value_counts()\n    data[gender] = counts\n\n# Közös országlista (top 8 bármelyik nemben)\nall_countries = pd.concat([data[\"Férfi\"], data[\"Nő\"]])\ntop_countries = all_countries.groupby(all_countries.index).sum().sort_values(ascending=False).head(8).index.tolist()\n\n# Adatok DataFrame-be\ndf_plot = pd.DataFrame({\n    \"Férfiak\": data[\"Férfi\"].reindex(top_countries, fill_value=0),\n    \"Nők\": data[\"Nő\"].reindex(top_countries, fill_value=0)\n}).T\n\nfig, ax = plt.subplots(figsize=(8,4))\ndf_plot.T.plot(kind=\"barh\", ax=ax)\nax.set_xlabel(\"Válaszadók száma\")\nax.set_ylabel(\"Ország\")\nax.set_title(\"Külföldi úti célok népszerűsége nemenként (Top 8 ország)\")\nax.legend(title=\"Nem\")\n\nresult = fig"}
{"timestamp": "2026-01-21T14:56:17.008565", "previous_question": null, "user_input": "Hány CASCO szerződés lett kötve 2022-ben? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Hány CASCO szerződés lett kötve 2022-ben? ", "app": "Insurance contract talk"}
{"timestamp": "2026-01-21T14:56:21.311328", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\n\nYEAR = 2022\nMOD = \"CASCO\"\n\ndf_tmp = df.copy()\ndf_tmp[\"Szerzodeskotes_datuma\"] = pd.to_datetime(\n    df_tmp[\"Szerzodeskotes_datuma\"], errors=\"coerce\"\n)\n\ndf_filtered = df_tmp[\n    (df_tmp[\"Szerzodeskotes_datuma\"].dt.year == YEAR) &\n    (df_tmp[\"Szerzodes_modozat\"] == MOD)\n]\n\nresult = int(len(df_filtered))"}
{"timestamp": "2026-01-21T14:56:42.263475", "previous_question": "Hány CASCO szerződés lett kötve 2022-ben? ", "user_input": "És GFK?", "gate_decision": "FOLLOWUP", "rewritten_question": "Hány CASCO és hány GFK szerződést kötöttek 2022-ben?", "sent_to_ai": "Hány CASCO és hány GFK szerződést kötöttek 2022-ben?", "app": "Insurance contract talk"}
{"timestamp": "2026-01-21T14:56:46.080469", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\n\nYEAR = 2022\nMODS = [\"CASCO\", \"GFK\"]\n\ndf_tmp = df.copy()\ndf_tmp[\"Szerzodeskotes_datuma\"] = pd.to_datetime(\n    df_tmp[\"Szerzodeskotes_datuma\"], errors=\"coerce\"\n)\n\ncounts = {}\nfor mod in MODS:\n    n = df_tmp[\n        (df_tmp[\"Szerzodeskotes_datuma\"].dt.year == YEAR) &\n        (df_tmp[\"Szerzodes_modozat\"] == mod)\n    ].shape[0]\n    counts[mod] = int(n)\n\nresult = counts"}
{"timestamp": "2026-01-21T14:57:36.867133", "previous_question": "Hány CASCO és hány GFK szerződést kötöttek 2022-ben?", "user_input": "Rajzolj egy vonadiagramot, ami havi bontásban mutatja hogy a GFK szerződések hány százaléka aktív jelenleg? ", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "Rajzolj egy vonadiagramot, ami havi bontásban mutatja hogy a GFK szerződések hány százaléka aktív jelenleg? ", "app": "Insurance contract talk"}
{"timestamp": "2026-01-21T14:57:43.204550", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme, format_date_axis\napply_default_theme()\nimport matplotlib.pyplot as plt\n\nCURRENT_DATE = pd.Timestamp(\"2025-02-28\")\nMOD = \"GFK\"\n\ndf_tmp = df.copy()\n\ndf_tmp[\"Szerzodeskotes_datuma\"] = pd.to_datetime(\n    df_tmp[\"Szerzodeskotes_datuma\"], errors=\"coerce\"\n)\ndf_tmp[\"Kockazatviselés_vege\"] = pd.to_datetime(\n    df_tmp[\"Kockazatviselés_vege\"], errors=\"coerce\"\n)\n\n# csak GFK + valid kötések\ndf_gfk = df_tmp[\n    (df_tmp[\"Szerzodes_modozat\"] == MOD) &\n    (df_tmp[\"Szerzodeskotes_datuma\"].notna())\n].copy()\n\ndf_gfk[\"Honap\"] = df_gfk[\"Szerzodeskotes_datuma\"].dt.to_period(\"M\")\n\nrecords = []\nfor m in sorted(df_gfk[\"Honap\"].dropna().unique()):\n    sub = df_gfk[df_gfk[\"Honap\"] == m]\n    total = len(sub)\n    if total == 0:\n        pct = 0.0\n    else:\n        active = sub[\n            sub[\"Kockazatviselés_vege\"].isna() |\n            (sub[\"Kockazatviselés_vege\"] > CURRENT_DATE)\n        ]\n        pct = float(len(active) / total * 100)\n\n    ts = m.to_timestamp(how=\"start\")\n    records.append((ts, pct))\n\ndf_plot = pd.DataFrame(records, columns=[\"Honap\", \"Aktiv_pct\"])\ndf_plot[\"Honap\"] = pd.to_datetime(df_plot[\"Honap\"], errors=\"coerce\")\n\nfig, ax = plt.subplots(figsize=(8,3))\nax.plot(df_plot[\"Honap\"], df_plot[\"Aktiv_pct\"], marker=\"o\")\n\nax.set_title(\"Új GFK szerződések: még aktív arány (%) havi bontásban\")\nax.set_ylabel(\"%\")\n\nformat_date_axis(ax)\n\nresult = fig"}
{"timestamp": "2026-01-21T14:58:00.855771", "previous_question": "Rajzolj egy vonadiagramot, ami havi bontásban mutatja hogy a GFK szerződések hány százaléka aktív jelenleg? ", "user_input": "Mutasd az összes módozatra!", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy vonaldiagramot, amely havi bontásban mutatja, hogy az összes GFK szerződés-módozat hány százaléka aktív jelenleg!", "sent_to_ai": "Rajzolj egy vonaldiagramot, amely havi bontásban mutatja, hogy az összes GFK szerződés-módozat hány százaléka aktív jelenleg!", "app": "Insurance contract talk"}
{"timestamp": "2026-01-21T14:58:06.952049", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme, format_date_axis\napply_default_theme()\nimport matplotlib.pyplot as plt\n\nCURRENT_DATE = pd.Timestamp(\"2025-02-28\")\nMOD = \"GFK\"\n\ndf_tmp = df.copy()\ndf_tmp[\"Szerzodeskotes_datuma\"] = pd.to_datetime(\n    df_tmp[\"Szerzodeskotes_datuma\"], errors=\"coerce\"\n)\ndf_tmp[\"Kockazatviselés_vege\"] = pd.to_datetime(\n    df_tmp[\"Kockazatviselés_vege\"], errors=\"coerce\"\n)\n\n# Csak GFK és érvényes kötési dátum\ndf_gfk = df_tmp[\n    (df_tmp[\"Szerzodes_modozat\"] == MOD) &\n    (df_tmp[\"Szerzodeskotes_datuma\"].notna())\n].copy()\n\ndf_gfk[\"Honap\"] = df_gfk[\"Szerzodeskotes_datuma\"].dt.to_period(\"M\")\n\nrecords = []\nfor m in sorted(df_gfk[\"Honap\"].dropna().unique()):\n    sub = df_gfk[df_gfk[\"Honap\"] == m]\n    total = len(sub)\n    if total == 0:\n        pct = 0.0\n    else:\n        active = sub[\n            sub[\"Kockazatviselés_vege\"].isna() |\n            (sub[\"Kockazatviselés_vege\"] > CURRENT_DATE)\n        ]\n        pct = float(len(active) / total * 100)\n    ts = m.to_timestamp(how=\"start\")\n    records.append((ts, pct))\n\ndf_plot = pd.DataFrame(records, columns=[\"Honap\", \"Aktiv_pct\"])\ndf_plot[\"Honap\"] = pd.to_datetime(df_plot[\"Honap\"], errors=\"coerce\")\n\nfig, ax = plt.subplots(figsize=(8,3))\nax.plot(df_plot[\"Honap\"], df_plot[\"Aktiv_pct\"], marker=\"o\")\n\nax.set_title(\"GFK szerződések: még aktív arány (%) havi bontásban\")\nax.set_ylabel(\"%\")\nax.set_xlabel(\"Kötés hónapja\")\n\nformat_date_axis(ax)\n\nresult = fig"}
{"timestamp": "2026-01-21T14:58:44.116450", "previous_question": "Rajzolj egy vonaldiagramot, amely havi bontásban mutatja, hogy az összes GFK szerződés-módozat hány százaléka aktív jelenleg!", "user_input": "Mutasd a CASCO-ra, Vagyon-ra és a többi módozatra is!", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy vonaldiagramot, amely havi bontásban mutatja, hogy az összes GFK szerződés-módozat, külön-külön (például CASCO, Vagyon és a többi módozat), hány százaléka aktív jelenleg!", "sent_to_ai": "Rajzolj egy vonaldiagramot, amely havi bontásban mutatja, hogy az összes GFK szerződés-módozat, külön-külön (például CASCO, Vagyon és a többi módozat), hány százaléka aktív jelenleg!", "app": "Insurance contract talk"}
{"timestamp": "2026-01-21T14:58:52.208980", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme, format_date_axis\napply_default_theme()\nimport matplotlib.pyplot as plt\n\nCURRENT_DATE = pd.Timestamp(\"2025-02-28\")\n\ndf_tmp = df.copy()\ndf_tmp[\"Szerzodeskotes_datuma\"] = pd.to_datetime(\n    df_tmp[\"Szerzodeskotes_datuma\"], errors=\"coerce\"\n)\ndf_tmp[\"Kockazatviselés_vege\"] = pd.to_datetime(\n    df_tmp[\"Kockazatviselés_vege\"], errors=\"coerce\"\n)\n\n# Csak érvényes kötések\ndf_tmp = df_tmp[df_tmp[\"Szerzodeskotes_datuma\"].notna()].copy()\n\n# Hónap képzése\ndf_tmp[\"Honap\"] = df_tmp[\"Szerzodeskotes_datuma\"].dt.to_period(\"M\")\n\nrecords = []\n\nfor (mod, honap), sub in df_tmp.groupby([\"Szerzodes_modozat\", \"Honap\"]):\n    total = len(sub)\n    if total == 0:\n        pct = 0.0\n    else:\n        active = sub[\n            sub[\"Kockazatviselés_vege\"].isna() |\n            (sub[\"Kockazatviselés_vege\"] > CURRENT_DATE)\n        ]\n        pct = float(len(active) / total * 100)\n    records.append({\n        \"Szerzodes_modozat\": mod,\n        \"Honap\": honap.to_timestamp(how=\"start\"),\n        \"Aktiv_pct\": pct\n    })\n\ndf_plot = pd.DataFrame(records)\ndf_plot[\"Honap\"] = pd.to_datetime(df_plot[\"Honap\"], errors=\"coerce\")\n\nfig, ax = plt.subplots(figsize=(8,3))\n\nfor mod, sub in df_plot.groupby(\"Szerzodes_modozat\"):\n    ax.plot(sub[\"Honap\"], sub[\"Aktiv_pct\"], marker=\"o\", label=mod)\n\nax.set_title(\"Új szerződések: jelenleg is aktív arány (%) havi bontásban – módozatonként\")\nax.set_ylabel(\"%\")\nax.legend(title=\"Módozat\")\n\nformat_date_axis(ax)\n\nresult = fig"}
{"timestamp": "2026-01-21T14:59:29.308893", "previous_question": "Rajzolj egy vonaldiagramot, amely havi bontásban mutatja, hogy az összes GFK szerződés-módozat, külön-külön (például CASCO, Vagyon és a többi módozat), hány százaléka aktív jelenleg!", "user_input": "A vonaldiagramban ne legyen marker! ", "gate_decision": "FOLLOWUP", "rewritten_question": "Rajzolj egy vonaldiagramot marker nélkül, amely havi bontásban mutatja, hogy az összes GFK szerződés-módozat, külön-külön (például CASCO, Vagyon és a többi módozat), hány százaléka aktív jelenleg!", "sent_to_ai": "Rajzolj egy vonaldiagramot marker nélkül, amely havi bontásban mutatja, hogy az összes GFK szerződés-módozat, külön-külön (például CASCO, Vagyon és a többi módozat), hány százaléka aktív jelenleg!", "app": "Insurance contract talk"}
{"timestamp": "2026-01-21T14:59:37.192707", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme, format_date_axis\napply_default_theme()\nimport matplotlib.pyplot as plt\n\nCURRENT_DATE = pd.Timestamp(\"2025-02-28\")\n\ndf_tmp = df.copy()\ndf_tmp[\"Szerzodeskotes_datuma\"] = pd.to_datetime(\n    df_tmp[\"Szerzodeskotes_datuma\"], errors=\"coerce\"\n)\ndf_tmp[\"Kockazatviselés_vege\"] = pd.to_datetime(\n    df_tmp[\"Kockazatviselés_vege\"], errors=\"coerce\"\n)\n\n# Csak érvényes kötések\ndf_tmp = df_tmp[df_tmp[\"Szerzodeskotes_datuma\"].notna()].copy()\n\n# Hónap képzése\ndf_tmp[\"Honap\"] = df_tmp[\"Szerzodeskotes_datuma\"].dt.to_period(\"M\")\n\nrecords = []\n\nfor (mod, honap), sub in df_tmp.groupby([\"Szerzodes_modozat\", \"Honap\"]):\n    total = len(sub)\n    if total == 0:\n        pct = 0.0\n    else:\n        active = sub[\n            sub[\"Kockazatviselés_vege\"].isna() |\n            (sub[\"Kockazatviselés_vege\"] > CURRENT_DATE)\n        ]\n        pct = float(len(active) / total * 100)\n    records.append({\n        \"Szerzodes_modozat\": mod,\n        \"Honap\": honap.to_timestamp(how=\"start\"),\n        \"Aktiv_pct\": pct\n    })\n\nimport pandas as pd\ndf_plot = pd.DataFrame(records)\ndf_plot[\"Honap\"] = pd.to_datetime(df_plot[\"Honap\"], errors=\"coerce\")\n\nfig, ax = plt.subplots(figsize=(8,3))\n\nfor mod, sub in df_plot.groupby(\"Szerzodes_modozat\"):\n    ax.plot(sub[\"Honap\"], sub[\"Aktiv_pct\"], label=mod)  # marker nélkül\n\nax.set_title(\"Új szerződések: még aktív arány (%) havi bontásban – termékenként\")\nax.set_ylabel(\"%\")\nax.legend(title=\"Termék\")\n\nformat_date_axis(ax)\n\nresult = fig"}
{"timestamp": "2026-01-21T15:03:30.601358", "previous_question": null, "user_input": "CASCO szerződések hány százaléka szűnik meg 1 éven belül", "gate_decision": "NEW", "rewritten_question": null, "sent_to_ai": "CASCO szerződések hány százaléka szűnik meg 1 éven belül", "app": "Insurance contract talk"}
{"timestamp": "2026-01-21T15:03:36.312078", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\n\nMOD = \"CASCO\"\nDAYS = 365\n\ndf_tmp = df.copy()\n\n# Dátummezők biztos kezelése\ndf_tmp[\"Szerzodeskotes_datuma\"] = pd.to_datetime(\n    df_tmp[\"Szerzodeskotes_datuma\"], errors=\"coerce\"\n)\ndf_tmp[\"Kockazatviselés_vege\"] = pd.to_datetime(\n    df_tmp[\"Kockazatviselés_vege\"], errors=\"coerce\"\n)\n\n# Csak CASCO, értelmezhető kötési dátum\ndf_casco = df_tmp[\n    (df_tmp[\"Szerzodes_modozat\"] == MOD) &\n    df_tmp[\"Szerzodeskotes_datuma\"].notna()\n].copy()\n\ntotal = len(df_casco)\n\nif total == 0:\n    result = 0.0\nelse:\n    # 1 éven belül megszűnt szerződések\n    terminated_within_1y = df_casco[\n        df_casco[\"Kockazatviselés_vege\"].notna() &\n        (df_casco[\"Kockazatviselés_vege\"] <= df_casco[\"Szerzodeskotes_datuma\"] + pd.Timedelta(days=DAYS))\n    ]\n    pct = len(terminated_within_1y) / total * 100\n    result = round(pct, 2)"}
{"timestamp": "2026-01-21T15:03:58.561931", "previous_question": "CASCO szerződések hány százaléka szűnik meg 1 éven belül", "user_input": "Melyik évben volt legmagasabb ez a ráta? ", "gate_decision": "FOLLOWUP", "rewritten_question": "Melyik évben volt a legmagasabb a 1 éven belül megszűnő CASCO szerződések aránya?", "sent_to_ai": "Melyik évben volt a legmagasabb a 1 éven belül megszűnő CASCO szerződések aránya?", "app": "Insurance contract talk"}
{"timestamp": "2026-01-21T15:04:05.463408", "generated_code": "import warnings; warnings.filterwarnings(\"ignore\")\nfrom matplotlib_theme import apply_default_theme\napply_default_theme()\nimport pandas as pd\n\nMOD = \"CASCO\"\nDAYS = 365\n\n# Másolat + dátumok\ndf_c = df[df[\"Szerzodes_modozat\"] == MOD].copy()\n\ndf_c[\"Szerzodeskotes_datuma\"] = pd.to_datetime(\n    df_c[\"Szerzodeskotes_datuma\"], errors=\"coerce\"\n)\ndf_c[\"Kockazatviselés_vege\"] = pd.to_datetime(\n    df_c[\"Kockazatviselés_vege\"], errors=\"coerce\"\n)\n\n# Csak értelmezhető kötési dátum\ndf_c = df_c[df_c[\"Szerzodeskotes_datuma\"].notna()].copy()\n\n# Év\ndf_c[\"Ev\"] = df_c[\"Szerzodeskotes_datuma\"].dt.year\n\nrecords = []\n\nfor ev in sorted(df_c[\"Ev\"].unique()):\n    sub = df_c[df_c[\"Ev\"] == ev]\n    total = len(sub)\n\n    if total == 0:\n        continue\n\n    # 1 éven belüli megszűnés\n    terminated_1y = sub[\n        sub[\"Kockazatviselés_vege\"].notna() &\n        (\n            sub[\"Kockazatviselés_vege\"]\n            <= sub[\"Szerzodeskotes_datuma\"] + pd.Timedelta(days=DAYS)\n        )\n    ]\n\n    pct = len(terminated_1y) / total * 100\n    records.append((ev, pct))\n\ndf_pct = pd.DataFrame(records, columns=[\"Ev\", \"pct\"])\n\nif len(df_pct) == 0:\n    result = None\nelse:\n    max_idx = df_pct[\"pct\"].idxmax()\n    max_ev = int(df_pct.loc[max_idx, \"Ev\"])\n    max_pct = round(float(df_pct.loc[max_idx, \"pct\"]), 2)\n    result = {\n        \"legmagasabb_ev\": max_ev,\n        \"legmagasabb_arany_szazalek\": max_pct,\n        \"ev_ervenyes_aranyok_szazalek\": {\n            int(row[\"Ev\"]): round(float(row[\"pct\"]), 2)\n            for _, row in df_pct.iterrows()\n        }\n    }"}
